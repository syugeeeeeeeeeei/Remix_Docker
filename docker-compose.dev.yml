services:
  remix:
    ports:
      - "5173:5173"
    volumes:
      - ./packages/remix:/app/packages/remix
      - ./packages/database:/app/packages/database
    command: yarn workspace remix-app dev

  api:
    ports:
      - "3001:3000"
    volumes:
      - ./packages/api:/app/packages/api
      - ./packages/database:/app/packages/database
    command: yarn workspace api start:dev

  database-tools:
    build:
      context: .
      dockerfile: ./packages/database/Dockerfile.dev
    container_name: database_tools_dev
    working_dir: /app/packages/database
    command: >
      sh -c "corepack enable && \
             yarn set version stable && \
             yarn config set nodeLinker node-modules && \
             yarn install && \
             yarn migrate:dev && \
             yarn generate"
    tty: true
    stdin_open: true
    volumes:
      - ./packages/database:/app/packages/database
    environment:
      - DATABASE_URL=${DATABASE_URL}
    depends_on:
      - postgres
    networks:
      - app_network